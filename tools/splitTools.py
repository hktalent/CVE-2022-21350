#!/usr/bin/env python3
# _*_ coding:utf-8 _*_
import sys, os, re, datetime, json,argparse,requests
from urllib.parse import urlparse

nChunck=1024*500
szCurlDir=os.getcwd()#os.path.dirname(os.path.abspath(__file__))

# 拆分
def fnSplit(filename):
    a=filename.split('/')
    szP='_'+a[len(a) - 1]#.split('.')[0]
    if not os.path.exists(szP):
        os.makedirs(szP)
    n = 0
    with open(filename,'rb') as fin:
        while(True):
            cN=fin.read(nChunck)
            if cN:
                fout = open(szCurlDir+'/'+szP+"/" + str(n) + '.chunk' ,"wb")
                fout.write(cN)
                fout.close()
                n=n+1
            else:
                break
    print(filename,' is Ok ',str(n))

def fnMerge(filename):
    szP=filename
    with open(szCurlDir+'/'+szP,'wb') as fin:
        for i in range(0,99999999):
            szCNm=szCurlDir+'/'+'_'+filename+"/"+str(i) + '.chunk'
            if os.path.exists(szCNm):
                f = open(szCNm,"rb")
                x=f.read(nChunck)
                fin.write(x)
                f.close()
            else:
                break
    print(filename,'  merge is Ok ')

if __name__ == '__main__':
    parser = argparse.ArgumentParser()
    parser.add_argument("-s","--splitFile",help="拆分大文件")
    parser.add_argument("-m","--merge",help="合并拆分大文件")
    args = parser.parse_args()
    if args.splitFile:
        fnSplit(args.splitFile)
    if args.merge:
        fnMerge(args.merge)